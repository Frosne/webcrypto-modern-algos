<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Modern Algorithms in the Web Cryptography API</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove"></script>
  <script class='remove'>
  "use strict";
  // See https://github.com/w3c/respec/wiki/ for how to configure ReSpec
  var respecConfig = {
    "github": "twiss/webcrypto-modern-algos",
    "editors": [
      {
        name: "Daniel Huigens",
        url: "mailto:daniel.huigens@proton.ch",
        company: "Proton AG",
        companyURL: "https://proton.me/",
      },
    ],
    "shortName": "webcrypto-modern-algos",
    "specStatus": "CG-DRAFT",
    "group": "wicg",
    "xref": ["WebIDL", "WebCryptoAPI"],
    localBiblio: {
      "JWA": {
        aliasOf: "RFC7518"
      },
      // TODO: move to specref?
      "FIPS-202": {
        "title": "SHA-3 Standard: Permutation-Based Hash and Extendable-Output Functions",
        "href": "https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf",
        "publisher": "NIST",
        "date": "August 2015"
      },
    },
  };
  </script>
</head>

<body>
  <section id="abstract">
    <p>
      This specification defines a number of modern cryptographic algorithms
      for the [[[WebCryptoAPI]]], namely AES-OCB, ChaCha20-Poly1305, and SHA-3.
    </p>
  </section>
  <section id="sotd">
    <p>
      This is an unofficial proposal.
    </p>
  </section>
  <section id="introduction" class="informative">
    <h2>Introduction</h2>
    <p>
      This proposal aims to modernize the set of cryptographic algorithms
      available in the [[[WebCryptoAPI]]], such that web applications can
      make use of the most secure and performant options available.
      To this end, the following cryptographic algorithms are added:
      <ul>
        <li>AES-OCB [[RFC7253]]</li>
        <li>ChaCha20-Poly1305 [[RFC8439]]</li>
        <li>SHA3-256, SHA3-384, and SHA3-512 [[FIPS-202]]</li>
      </ul>
    </p>
  </section>
  <section id="specification-conventions">
    <h2>Specification Conventions</h3>
    <p>
      This specification follows the <a data-cite="WebCryptoAPI#algorithm-conventions">conventions</a>
      laid out in Section 18.3 of [[WebCryptoAPI]]. None of the algorithms defined here
      are required to be implemented, but if a conforming User Agent implements an
      algorithm, it MUST implement all of the supported operations specified in this
      document, and must perform the steps to <a data-cite="WebCryptoAPI#concept-define-an-algorithm">define an algorithm</a>
      specified in section 18.4.3 of [[WebCryptoAPI]] for each of the supported operations.
    </p>
  </section>
  <section id="terminology">
    <h2>Terminology</h2>
    <p>
      An <dfn id="dfn-octet-string">octet string</dfn> is an ordered sequence of zero or more
      integers, each in the range 0 to 255 inclusive.
    </p>
    <p>
      When this specification states to supply the <dfn id="concept-contents-of-arraybuffer">
      contents of an ArrayBuffer</dfn> named |data| to an underlying cryptographic
      implementation, the User Agent shall supply a contiguous sequence of bytes that is equal
      to the result of
      [= get a copy of the buffer source | getting a copy of the bytes =]
      held |data|.
    </p>
  </section>

  <section id="aes-ocb">
    <h3>AES-OCB</h3>
    <section id="aes-ocb-description" class="informative">
      <h4>Description</h4>
      <p>
        The "`AES-OCB`" algorithm identifier is used to perform
        authenticated encryption and decryption using AES in OCB mode,
        as described in [[RFC7253]].
      </p>
    </section>
    <section id="aes-ocb-registration">
      <h4>Registration</h4>
      <p>
        The [= recognized algorithm name =] for
        this algorithm is "`AES-OCB`".
      </p>
      <table>
        <thead>
          <tr>
            <th><a href="#supported-operations">Operation</a></th>
            <th><a href="#algorithm-specific-params">Parameters</a></th>
            <th><a href="#algorithm-result">Result</a></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>encrypt</td>
            <td>{{AeadParams}}</td>
            <td>{{ArrayBuffer}}</td>
          </tr>
          <tr>
            <td>decrypt</td>
            <td>{{AeadParams}}</td>
            <td>{{ArrayBuffer}}</td>
          </tr>
          <tr>
            <td>generateKey</td>
            <td>{{AesKeyGenParams}}</td>
            <td>{{CryptoKey}}</td>
          </tr>
         <tr>
           <td>importKey</td>
           <td>None</td>
           <td>{{CryptoKey}}</td>
         </tr>
         <tr>
           <td>exportKey</td>
           <td>None</td>
           <td>object</td>
         </tr>
         <tr>
           <td>get key length</td>
           <td>{{AesDerivedKeyParams}}</td>
           <td>Integer</td>
         </tr>
        </tbody>
      </table>
    </section>
    <section id="aead-params">
      <h4><dfn data-idl id="dfn-AeadParams">AeadParams</dfn> dictionary</h4>
      <pre class=idl>
dictionary AeadParams : Algorithm {
  required BufferSource iv;
  BufferSource additionalData;
  [EnforceRange] octet tagLength;
};
      </pre>
      <p>The <dfn data-dfn-for=AeadParams id=dfn-AeadParams-iv>iv</dfn> member represents the initialization vector to use.</p>
      <p>The <dfn data-dfn-for=AeadParams id=dfn-AeadParams-additionalData>additionalData</dfn> member represents the additional authentication data to include.</p>
      <p>The <dfn data-dfn-for=AeadParams id=dfn-AeadParams-tagLength>tagLength</dfn> member represents the desired length of the authentication tag.</p>
      <div class=note>
        <p>
          The {{AeadParams}} dictionary is identical to the {{AesGcmParams}} dictionary of [[WebCryptoAPI]],
          and the latter may be replaced by the former when merging this proposal.
        </p>
      </div>
    </section>
    <section id="aes-ocb-operations">
      <h4>Operations</h4>
      <dl>
        <dt>Encrypt</dt>
        <dd>
          <ol>
            <li>
              <p>
                If the {{AeadParams/iv}} member of
                |normalizedAlgorithm| has a length greater than 15
                bytes,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <dl class="switch">
                <dt>If the {{AeadParams/tagLength}} member of
                |normalizedAlgorithm| is not present:</dt>
                <dd>Let |tagLength| be 128.</dd>
                <dt>If the {{AeadParams/tagLength}} member of
                |normalizedAlgorithm| is one of 64, 96 or 128:</dt>
                <dd>Let |tagLength| be equal to the
                {{AeadParams/tagLength}} member of
                 |normalizedAlgorithm|</dd>
                <dt>Otherwise:</dt>
                <dd>
                  [= exception/throw =] an
                  {{OperationError}}.
                </dd>
              </dl>
            </li>
            <li>
              <p>
                Let |additionalData| be <a href="#concept-contents-of-arraybuffer">the contents of</a> the {{AeadParams/additionalData}} member of
                |normalizedAlgorithm| if present or the empty octet
                string otherwise.
              </p>
            </li>
            <li>
              <p>
                Let |C| be the output that results from performing
                the OCB-ENCRYPT function described in Section 4.2 of
                [[RFC7253]] using AES as the block cipher, using
                the key represented by {{CryptoKey/[[handle]]}}
                internal slot of |key| as the |K| input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of</a> the {{AeadParams/iv}} member of |normalizedAlgorithm| as
                the |N| input parameter, <a href="#concept-contents-of-arraybuffer">the contents of
                |additionalData|</a> as the |A| input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of
                |plaintext|</a> as the |P| input parameter, and
                |tagLength| as the |TAGLEN| global parameter.
              </p>
            </li>
            <li>
              <p>
                Return the result of [= ArrayBuffer/create | creating =]
                an {{ArrayBuffer}} containing |C|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Decrypt</dt>
        <dd>
          <ol>
            <li>
              <dl class="switch">
                <dt>If the {{AeadParams/tagLength}} member of
                |normalizedAlgorithm| is not present:</dt>
                <dd>Let |tagLength| be 128.</dd>
                <dt>If the {{AeadParams/tagLength}} member of
                |normalizedAlgorithm| is one of 64, 96 or 128:</dt>
                <dd>Let |tagLength| be equal to the
                {{AeadParams/tagLength}} member of
                 |normalizedAlgorithm|</dd>
                <dt>Otherwise:</dt>
                <dd>
                  [= exception/throw =] an
                  {{OperationError}}.
                </dd>
              </dl>
            </li>
            <li>
              <p>
                If |ciphertext| has a length less than |tagLength| bits,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                If the {{AeadParams/iv}} member of
                |normalizedAlgorithm| has a length greater than 15
                bytes,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Let |additionalData| be <a href="#concept-contents-of-arraybuffer">the contents</a> of the {{AeadParams/additionalData}} member of
                |normalizedAlgorithm| if present or the empty octet
                string otherwise.
              </p>
            </li>
            <li>
              <p>
                Perform the OCB-DECRYPT function described in Section 4.3 of
                [[RFC7253]] using AES as the block cipher, using
                the key represented by {{CryptoKey/[[handle]]}}
                internal slot of |key| as the |K| input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of</a> the {{AeadParams/iv}} member of |normalizedAlgorithm| as
                the |N| input parameter, <a href="#concept-contents-of-arraybuffer">the contents of
                |additionalData|</a> as the |A| input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of
                |ciphertext|</a> as the |C| input parameter, and
                |tagLength| as the |TAGLEN| global parameter.
              </p>
              <dl class="switch">
                <dt>If the result of the algorithm is the indication of authentication failure,
                "INVALID":</dt>
                <dd>
                  [= exception/throw =] an
                  {{OperationError}}
                </dd>
                <dt>Otherwise:</dt>
                <dd>Let |plaintext| be the output |P| of OCB-DECRYPT.</dd>
              </dl>
            </li>
            <li>
              <p>
                Return the result of [= ArrayBuffer/create | creating =]
                an {{ArrayBuffer}} containing |plaintext|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Generate Key</dt>
        <dd>
          <ol>
            <li>
              <p>
                If |usages| contains any entry which is not
                one of "`encrypt`", "`decrypt`",
                "`wrapKey`" or "`unwrapKey`",
                then [= exception/throw =] a
                {{SyntaxError}}.
              </p>
            </li>
            <li>
              <p>
                If the {{AesKeyGenParams/length}} member of
                |normalizedAlgorithm| is not equal to one of
                128, 192 or 256,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>

            <li>
              <p>
                Generate an AES key of length
                equal to the {{AesKeyGenParams/length}} member of
                |normalizedAlgorithm|.
              </p>
            </li>
            <li>
              <p>
                If the key generation step fails,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Let |key| be a new
                {{CryptoKey}} object representing the
                generated AES key.
              </p>
            </li>
            <li>
              <p>
                Let |algorithm| be a new
                {{AesKeyAlgorithm}}.
              </p>
            </li>
            <li>
              <p>
                Set the {{KeyAlgorithm/name}} attribute of
                |algorithm| to "`AES-OCB`".
              </p>
            </li>
            <li>
              <p>
                Set the {{AesKeyAlgorithm/length}} attribute of
                |algorithm| to equal the
                {{AesKeyGenParams/length}} member of
                |normalizedAlgorithm|.
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[algorithm]]}} internal
                slot of |key| to |algorithm|.
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[extractable]]}} internal
                slot of |key| to be |extractable|.
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[usages]]}} internal slot of
                |key| to be |usages|.
              </p>
            </li>
            <li>
              <p>
                Return |key|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Import Key</dt>
        <dd>
          <ol>
            <li>
              <p>
                If |usages| contains an entry which is not
                one of "`encrypt`", "`decrypt`",
                "`wrapKey`" or "`unwrapKey`",
                then [= exception/throw =] a
                {{SyntaxError}}.
              </p>
            </li>
            <li>
              <dl class="switch">
                <dt>If |format| is {{KeyFormat/"raw"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <p>
                        Let |data| be the [= octet string =] contained in |keyData|.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the length in bits of |data| is not 128, 192 or 256
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>If |format| is {{KeyFormat/"jwk"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <dl class="switch">
                        <dt>If |keyData| is a {{JsonWebKey}} dictionary:</dt>
                        <dd><p>Let |jwk| equal |keyData|.</p></dd>
                        <dt>Otherwise:</dt>
                        <dd><p>[= exception/Throw =] a {{DataError}}.</p></dd>
                      </dl>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/kty}} field of |jwk| is not
                        "`oct`",
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If |jwk| does not meet the requirements of
                        Section 6.4 of JSON Web Algorithms [[JWA]],
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        Let |data| be the [= octet string =] obtained by decoding the
                        {{JsonWebKey/k}} field of |jwk|.
                      </p>
                    </li>
                    <li>
                      <dl class="switch">
                        <dt>If |data| has length 128 bits:</dt>
                        <dd>If the {{JsonWebKey/alg}} field of |jwk| is present, and is
                        not "`A128OCB`",
                          then [= exception/throw =] a
                          {{DataError}}.</dd>
                        <dt>If |data| has length 192 bits:</dt>
                        <dd>If the {{JsonWebKey/alg}} field of |jwk| is present, and is
                        not "`A192OCB`",
                          then [= exception/throw =] a
                          {{DataError}}.</dd>
                        <dt>If |data| has length 256 bits:</dt>
                        <dd>If the {{JsonWebKey/alg}} field of |jwk| is present, and is
                        not "`A256OCB`",
                          then [= exception/throw =] a
                          {{DataError}}.</dd>
                        <dt>Otherwise:</dt>
                        <dd>
                          [= exception/throw =] a
                          {{DataError}}.
                        </dd>
                      </dl>
                    </li>
                    <li>
                      <p>
                        If |usages| is non-empty and the {{JsonWebKey/use}} field of |jwk| is present and is
                        not "`enc`",
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/key_ops}} field of |jwk| is present, and
                        is invalid according to the requirements of
                        JSON Web Key [[JWK]] or
                        does not contain all of the specified |usages| values,
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/ext}} field of |jwk| is present and
                        has the value false and |extractable| is true,
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>Otherwise:</dt>
                <dd>
                  [= exception/throw =] a
                  {{NotSupportedError}}.
                </dd>
              </dl>
            </li>
            <li>
              <p>
                Let |key| be a new `{{CryptoKey}}`
                object representing an AES key with value |data|.
              </p>
            </li>
            <li>
              <p>
                Let |algorithm| be a new
                {{AesKeyAlgorithm}}.
              </p>
            </li>
            <li>
              <p>
                Set the {{KeyAlgorithm/name}} attribute of
                |algorithm| to "`AES-OCB`".
              </p>
            </li>
            <li>
              <p>
                Set the {{AesKeyAlgorithm/length}} attribute of
                |algorithm| to the length, in bits, of |data|.
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[algorithm]]}} internal
                slot of |key| to |algorithm|.
              </p>
            </li>
            <li>
              <p>
                Return |key|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Export Key</dt>
        <dd>
          <ol>
            <li>
              <p>
                If the underlying cryptographic key material represented by the {{CryptoKey/[[handle]]}} internal slot of |key|
                cannot be accessed, then [= exception/throw =] an {{OperationError}}.
              </p>
            </li>
            <li>
              <dl class="switch">
                <dt>If |format| is {{KeyFormat/"raw"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <p>
                        Let |data| be the raw octets of the key represented by {{CryptoKey/[[handle]]}} internal slot of
                        |key|.
                      </p>
                    </li>
                    <li>
                      <p>
                        Let |result| be the result of [= ArrayBuffer/create | creating =]
                        an {{ArrayBuffer}} containing |data|.
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>If |format| is {{KeyFormat/"jwk"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <p>
                        Let |jwk| be a new {{JsonWebKey}}
                        dictionary.
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the `kty` attribute of |jwk| to the
                        string "`oct`".
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the {{JsonWebKey/k}} attribute of |jwk| to be a string
                        containing the raw octets of the key represented by {{CryptoKey/[[handle]]}} internal slot of
                        |key|, encoded according to Section 6.4 of JSON Web Algorithms [[JWA]].
                      </p>
                    </li>
                    <li>
                      <dl class="switch">
                        <dt>If the {{AesKeyAlgorithm/length}} attribute of
                        |key| is 128:</dt>
                        <dd>Set the `alg` attribute of |jwk| to
                        the string "`A128OCB`".</dd>
                        <dt>If the {{AesKeyAlgorithm/length}} attribute of
                        |key| is 192:</dt>
                        <dd>Set the `alg` attribute of |jwk| to
                        the string "`A192OCB`".</dd>
                        <dt>If the {{AesKeyAlgorithm/length}} attribute of
                        |key| is 256:</dt>
                        <dd>Set the `alg` attribute of |jwk| to
                        the string "`A256OCB`".</dd>
                      </dl>
                    </li>
                    <li>
                      <p>
                        Set the `key_ops` attribute of |jwk| to equal the
                        {{CryptoKey/usages}} attribute of
                        |key|.
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the `ext` attribute of |jwk| to equal the {{CryptoKey/[[extractable]]}} internal slot
                        of |key|.
                      </p>
                    </li>
                    <li>
                      <p>
                        Let |result| be the result of converting |jwk|
                        to an ECMAScript Object, as defined by [[WebIDL]].
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>Otherwise:</dt>
                <dd>
                  <p>
                    [= exception/throw =] a
                    {{NotSupportedError}}.
                  </p>
                </dd>
              </dl>
            </li>
            <li>
              <p>
                Return |result|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Get key length</dt>
        <dd>
          <ol>
            <li>
              <p>
                If the {{AesDerivedKeyParams/length}} member of
                |normalizedDerivedKeyAlgorithm| is not 128, 192 or 256, then [= exception/throw =] an {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Return the {{AesDerivedKeyParams/length}} member of
                |normalizedDerivedKeyAlgorithm|.
              </p>
            </li>
          </ol>
        </dd>
      </dl>
    </section>
  </section>

  <section id="chacha20-poly1305">
    <h3>ChaCha20-Poly1305</h3>
    <section id="chacha20-poly1305-description" class="informative">
      <h4>Description</h4>
      <p>
        The "`ChaCha20-Poly1305`" algorithm identifier is used to perform
        authenticated encryption and decryption using AEAD_CHACHA20_POLY1305,
        as described in [[RFC8439]].
      </p>
    </section>
    <section id="chacha20-poly1305-registration">
      <h4>Registration</h4>
      <p>
        The [= recognized algorithm name =] for
        this algorithm is "`ChaCha20-Poly1305`".
      </p>
      <table>
        <thead>
          <tr>
            <th><a href="#supported-operations">Operation</a></th>
            <th><a href="#algorithm-specific-params">Parameters</a></th>
            <th><a href="#algorithm-result">Result</a></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>encrypt</td>
            <td>{{AeadParams}}</td>
            <td>{{ArrayBuffer}}</td>
          </tr>
          <tr>
            <td>decrypt</td>
            <td>{{AeadParams}}</td>
            <td>{{ArrayBuffer}}</td>
          </tr>
          <tr>
            <td>generateKey</td>
            <td>None</td>
            <td>{{CryptoKey}}</td>
          </tr>
         <tr>
           <td>importKey</td>
           <td>None</td>
           <td>{{CryptoKey}}</td>
         </tr>
         <tr>
           <td>exportKey</td>
           <td>None</td>
           <td>object</td>
         </tr>
         <tr>
           <td>get key length</td>
           <td>None</td>
           <td>Integer</td>
         </tr>
        </tbody>
      </table>
    </section>
    <section id="chacha20-poly1305-operations">
      <h4>Operations</h4>
      <dl>
        <dt>Encrypt</dt>
        <dd>
          <ol>
            <li>
              <p>
                If the {{AeadParams/iv}} member of
                |normalizedAlgorithm| does not have a length of 12 bytes,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                If the {{AeadParams/tagLength}} member
                of |normalizedAlgorithm| is present and is not 128,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Let |additionalData| be <a href="#concept-contents-of-arraybuffer">the contents of</a> the {{AeadParams/additionalData}} member of
                |normalizedAlgorithm| if present or the empty octet
                string otherwise.
              </p>
            </li>
            <li>
              <p>
                Let |ciphertext| be the output that results from
                performing the AEAD_CHACHA20_POLY1305 encryption algorithm
                described in Section 2.8 of [[RFC8439]], using
                the key represented by {{CryptoKey/[[handle]]}}
                internal slot of |key| as the key input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of</a> the {{AeadParams/iv}} member of |normalizedAlgorithm| as
                the nonce input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of
                |plaintext|</a> as the plaintext input parameter, and
                <a href="#concept-contents-of-arraybuffer">the contents of
                |additionalData|</a> as the additional authenticated data (AAD) input parameter.
              </p>
            </li>
            <li>
              <p>
                Return the result of [= ArrayBuffer/create | creating =]
                an {{ArrayBuffer}} containing |ciphertext|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Decrypt</dt>
        <dd>
          <ol>
            <li>
              <dl class="switch">
                <dt>If the {{AeadParams/tagLength}} member of
                |normalizedAlgorithm| is not present:</dt>
                <dd>Let |tagLength| be 128.</dd>
                <dt>If the {{AeadParams/tagLength}} member of
                |normalizedAlgorithm| is one of 64, 96 or 128:</dt>
                <dd>Let |tagLength| be equal to the
                {{AeadParams/tagLength}} member of
                 |normalizedAlgorithm|</dd>
                <dt>Otherwise:</dt>
                <dd>
                  [= exception/throw =] an
                  {{OperationError}}.
                </dd>
              </dl>
            </li>
            <li>
              <p>
                If |ciphertext| has a length less than |tagLength| bits,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                If the {{AeadParams/iv}} member of
                |normalizedAlgorithm| has a length greater than 15
                bytes,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Let |additionalData| be <a href="#concept-contents-of-arraybuffer">the contents</a> of the {{AeadParams/additionalData}} member of
                |normalizedAlgorithm| if present or the empty octet
                string otherwise.
              </p>
            </li>
            <li>
              <p>
                Perform the AEAD_CHACHA20_POLY1305 decryption algorithm
                described in Section 2.8 of [[RFC8439]], using
                the key represented by {{CryptoKey/[[handle]]}}
                internal slot of |key| as the key input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of</a> the {{AeadParams/iv}} member of |normalizedAlgorithm| as
                the nonce input parameter,
                <a href="#concept-contents-of-arraybuffer">the contents of
                |ciphertext|</a> as the ciphertext input parameter, and
                <a href="#concept-contents-of-arraybuffer">the contents of
                |additionalData|</a> as the additional authenticated data (AAD) input parameter.
              </p>
              <dl class="switch">
                <dt>If the result of the algorithm is the indication of authentication failure:</dt>
                <dd>
                  [= exception/throw =] an
                  {{OperationError}}
                </dd>
                <dt>Otherwise:</dt>
                <dd>Let |plaintext| be the resulting plaintext.</dd>
              </dl>
            </li>
            <li>
              <p>
                Return the result of [= ArrayBuffer/create | creating =]
                an {{ArrayBuffer}} containing |plaintext|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Generate Key</dt>
        <dd>
          <ol>
            <li>
              <p>
                If |usages| contains any entry which is not
                one of "`encrypt`", "`decrypt`",
                "`wrapKey`" or "`unwrapKey`",
                then [= exception/throw =] a
                {{SyntaxError}}.
              </p>
            </li>

            <li>
              <p>
                Generate a 256-bit key.
              </p>
            </li>
            <li>
              <p>
                If the key generation step fails,
                then [= exception/throw =] an
                {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Let |key| be a new
                {{CryptoKey}} object representing the
                generated key.
              </p>
            </li>
            <li>
              <p>
                Let |algorithm| be a new
                {{KeyAlgorithm}}.
              </p>
            </li>
            <li>
              <p>
                Set the {{KeyAlgorithm/name}} attribute of
                |algorithm| to "`ChaCha20-Poly1305`".
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[algorithm]]}} internal
                slot of |key| to |algorithm|.
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[extractable]]}} internal
                slot of |key| to be |extractable|.
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[usages]]}} internal slot of
                |key| to be |usages|.
              </p>
            </li>
            <li>
              <p>
                Return |key|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Import Key</dt>
        <dd>
          <ol>
            <li>
              <p>
                If |usages| contains an entry which is not
                one of "`encrypt`", "`decrypt`",
                "`wrapKey`" or "`unwrapKey`",
                then [= exception/throw =] a
                {{SyntaxError}}.
              </p>
            </li>
            <li>
              <dl class="switch">
                <dt>If |format| is {{KeyFormat/"raw"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <p>
                        Let |data| be the [= octet string =] contained in |keyData|.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the length in bits of |data| is not 256
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>If |format| is {{KeyFormat/"jwk"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <dl class="switch">
                        <dt>If |keyData| is a {{JsonWebKey}} dictionary:</dt>
                        <dd><p>Let |jwk| equal |keyData|.</p></dd>
                        <dt>Otherwise:</dt>
                        <dd><p>[= exception/Throw =] a {{DataError}}.</p></dd>
                      </dl>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/kty}} field of |jwk| is not
                        "`oct`",
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If |jwk| does not meet the requirements of
                        Section 6.4 of JSON Web Algorithms [[JWA]],
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        Let |data| be the [= octet string =] obtained by decoding the
                        {{JsonWebKey/k}} field of |jwk|.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/alg}} field of |jwk| is present, and is
                        not "`CC20P1305`",
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If |usages| is non-empty and the {{JsonWebKey/use}} field of |jwk| is present and is
                        not "`enc`",
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/key_ops}} field of |jwk| is present, and
                        is invalid according to the requirements of
                        JSON Web Key [[JWK]] or
                        does not contain all of the specified |usages| values,
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                    <li>
                      <p>
                        If the {{JsonWebKey/ext}} field of |jwk| is present and
                        has the value false and |extractable| is true,
                        then [= exception/throw =] a
                        {{DataError}}.
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>Otherwise:</dt>
                <dd>
                  [= exception/throw =] a
                  {{NotSupportedError}}.
                </dd>
              </dl>
            </li>
            <li>
              <p>
                Let |key| be a new `{{CryptoKey}}`
                object representing a key with value |data|.
              </p>
            </li>
            <li>
              <p>
                Let |algorithm| be a new
                {{KeyAlgorithm}}.
              </p>
            </li>
            <li>
              <p>
                Set the {{KeyAlgorithm/name}} attribute of
                |algorithm| to "`ChaCha20-Poly1305`".
              </p>
            </li>
            <li>
              <p>
                Set the {{CryptoKey/[[algorithm]]}} internal
                slot of |key| to |algorithm|.
              </p>
            </li>
            <li>
              <p>
                Return |key|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Export Key</dt>
        <dd>
          <ol>
            <li>
              <p>
                If the underlying cryptographic key material represented by the {{CryptoKey/[[handle]]}} internal slot of |key|
                cannot be accessed, then [= exception/throw =] an {{OperationError}}.
              </p>
            </li>
            <li>
              <dl class="switch">
                <dt>If |format| is {{KeyFormat/"raw"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <p>
                        Let |data| be the raw octets of the key represented by {{CryptoKey/[[handle]]}} internal slot of
                        |key|.
                      </p>
                    </li>
                    <li>
                      <p>
                        Let |result| be the result of [= ArrayBuffer/create | creating =]
                        an {{ArrayBuffer}} containing |data|.
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>If |format| is {{KeyFormat/"jwk"}}:</dt>
                <dd>
                  <ol>
                    <li>
                      <p>
                        Let |jwk| be a new {{JsonWebKey}}
                        dictionary.
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the `kty` attribute of |jwk| to the
                        string "`oct`".
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the {{JsonWebKey/k}} attribute of |jwk| to be a string
                        containing the raw octets of the key represented by {{CryptoKey/[[handle]]}} internal slot of
                        |key|, encoded according to Section 6.4 of JSON Web Algorithms [[JWA]].
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the `alg` attribute of |jwk| to
                        the string "`CC20P1305`".
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the `key_ops` attribute of |jwk| to equal the
                        {{CryptoKey/usages}} attribute of
                        |key|.
                      </p>
                    </li>
                    <li>
                      <p>
                        Set the `ext` attribute of |jwk| to equal the {{CryptoKey/[[extractable]]}} internal slot
                        of |key|.
                      </p>
                    </li>
                    <li>
                      <p>
                        Let |result| be the result of converting |jwk|
                        to an ECMAScript Object, as defined by [[WebIDL]].
                      </p>
                    </li>
                  </ol>
                </dd>
                <dt>Otherwise:</dt>
                <dd>
                  <p>
                    [= exception/throw =] a
                    {{NotSupportedError}}.
                  </p>
                </dd>
              </dl>
            </li>
            <li>
              <p>
                Return |result|.
              </p>
            </li>
          </ol>
        </dd>
        <dt>Get key length</dt>
        <dd>
          <ol>
            <li>
              <p>
                Return 256.
              </p>
            </li>
          </ol>
        </dd>
      </dl>
    </section>
  </section>
  <section id="sha3">
    <h3>SHA-3</h3>
    <section id="sha3-description" class="informative">
      <h4>Description</h4>
      <p>
        This describes the SHA-3 family of hash functions, as specified by
        [[FIPS-202]].
      </p>
    </section>
    <section id="sha3-registration">
      <h4>Registration</h4>
      <p>
        The <a href="#recognized-algorithm-name">recognized algorithm names</a> are
        "<code id="alg-sha3-256">SHA3-256</code>",
        "<code id="alg-sha3-384">SHA3-384</code>", and
        "<code id="alg-sha3-512">SHA3-512</code>" for the respective SHA-3 algorithms.
      </p>
      <table>
        <thead>
          <tr>
            <th><a href="#supported-operations">Operation</a></th>
            <th><a href="#algorithm-specific-params">Parameters</a></th>
            <th><a href="#algorithm-result">Result</a></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>digest</td>
            <td>None</td>
            <td>{{ArrayBuffer}}</td>
          </tr>
        </tbody>
      </table>
    </section>
    <section id="sha3-operations">
      <h4>Operations</h4>
      <dl>
        <dt>Digest</dt>
        <dd>
          <ol>
            <li>
              <dl class="switch">
                <dt>
                  If the {{Algorithm/name}} member of
                  |normalizedAlgorithm| is a case-sensitive string match for
                  "`SHA3-256`":
                </dt>
                <dd>
                  Let |result| be the result of performing the SHA3-256 hash function
                  defined in Section 6.1 of [[FIPS-202]] using
                  |message| as the input message, |M|.
                </dd>
                <dt>
                  If the {{Algorithm/name}} member of
                  |normalizedAlgorithm| is a case-sensitive string match for
                  "`SHA3-384`":
                </dt>
                <dd>
                  Let |result| be the result of performing the SHA3-384 hash function
                  defined in Section 6.1 of [[FIPS-202]] using
                  |message| as the input message, |M|.
                </dd>
                <dt>
                  If the {{Algorithm/name}} member of
                  |normalizedAlgorithm| is a case-sensitive string match for
                  "`SHA3-512`":
                </dt>
                <dd>
                  Let |result| be the result of performing the SHA3-512 hash function
                  defined in Section 6.1 of [[FIPS-202]] using
                  |message| as the input message, |M|.
                </dd>
              </dl>
            </li>
            <li>
              <p>
                If performing the operation results in an error, then [= exception/throw =] an {{OperationError}}.
              </p>
            </li>
            <li>
              <p>
                Return a new ArrayBuffer containing |result|.
              </p>
            </li>
          </ol>
        </dd>
      </dl>
    </section>
  </section>

  <section>
    <h2>Usage Example</h2>
    <p>
      This example encrypts and decrypts some data using AES-OCB.
    </p>
    <pre class="example js" title="AES-OCB encryption">
      const data = new TextEncoder().encode('Hello, world!');
      const aesAlgorithmKeyGen = {
        name: 'AES-OCB',
        // AesKeyGenParams
        length: 256
      };
      const aesAlgorithmEncrypt = {
        name: 'AES-OCB',
        // AeadParams
        iv: crypto.getRandomValues(new Uint8Array(16))
      };
      const key = await crypto.subtle.generateKey(aesAlgorithmKeyGen, false, ['encrypt']);
      const encrypted = await crypto.subtle.encrypt(aesAlgorithmEncrypt, key, data);
    </pre>
  </section>

  <section id="jwk-mapping" class="appendix informative">
    <h2>Mapping between JSON Web Key / JSON Web Algorithm</h2>
    <p>
      Refer to algorithm-specific sections for the
      normative requirements of importing and exporting JWK.
    </p>
    <h3>Algorithm mappings</h3>
    <table>
      <thead>
        <tr>
          <th scope="col">JSON Web Key</th>
          <th scope="col">AlgorithmIdentifier</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
<pre class=js>
{ kty: "oct",
alg: "A128OCB" }
</pre>
          </td>
          <td>
<pre class=js>
{ name: "AES-OCB",
length: 128 }
</pre>
          </td>
        </tr>
        <tr>
          <td>
<pre class=js>
{ kty: "oct",
alg: "A192OCB" }
</pre>
          </td>
          <td>
<pre class=js>
{ name: "AES-OCB",
length: 192 }
</pre>
          </td>
        </tr>
        <tr>
          <td>
<pre class=js>
{ kty: "oct",
alg: "A256OCB" }
</pre>
          </td>
          <td>
<pre class=js>
{ name: "AES-OCB",
length: 256 }
</pre>
          </td>
        </tr>
        <tr>
          <td>
<pre class=js>
{ kty: "oct",
alg: "CC20P1305" }
</pre>
          </td>
          <td>
<pre class=js>
{ name: "ChaCha20-Poly1305" }
</pre>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="todo">TODO: register A128OCB, A192OCB, A256OCB, and CC20P1305(?) with IANA in the JSON Web Signature and Encryption Algorithms registry.</div>
  </section>

  <section id="conformance"></section>
</body>

</html>
